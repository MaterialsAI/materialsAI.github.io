I"≤F<h1 id="iot---temperature-and-humidity-sensor-hookup-guide---mae540-2017-team-7">IoT - Temperature and Humidity Sensor hookup guide - MAE540-2017 Team 7</h1>
<p>By Alexander Wilson, Hao Wu, James Sandrolini, Vaibhav Jhawar</p>

<h3 id="narrative-of-the-application">Narrative of the application</h3>

<p>Temperature and humidity sensors can be used in vast area of applications. One application is weather stations around the globe, where the sensor can gather both temperature and humidity of the location.</p>

<p>In this application, we see how close the sensor would get to the actual data from local weather sources, like the Weather Channel Application. The temperature and humidity sensor that was chosen for this experiment is the Si7021, which is available from Sparkfun.</p>

<p>For this project, you will need a Sparkfun Si7021, The SparkFun ESP8266 Thing board, FTDI Basic -3.3V, SparkFun Cerberus USB Cable, Jumper Wires, a Breadboard and an Arduino stackable header. You will also need an Android/Apple smartphone to use Blynk app and a computer to compile the code.</p>

<h3 id="introduction-to-the-sensor">Introduction to the sensor</h3>

<p>The Sparkfun Si7021 is a humidity and temperature sensor. The sensor operates at 3.3 volts and has a built in analog to digital converter, signal processing, and internally stored calibration data. The sensor communicates over the I2C communications bus and contains all the necessary pull up resistors integrated into the board. The sensor is very accurate and has a temperature range of -10 to 85 degrees Celsius and can be accurate within +- 0.4 degrees Celsius. The humidity rang is from 0% to 80% relative humidity and is accurate within +- 3%. Power consumption of the sensor is very low, with a current draw of 15 micro amps while active and only 60 Nano amps in standby. The sensor is designed for dry applications and should not be submerged in liquids.</p>

<h3 id="schematic-of-the-hookup">Schematic of the hookup</h3>

<p>The pressure sensor (Si7021) has four pins:</p>

<ol>
  <li>‚ÄúGND‚Äù (ground)</li>
  <li>‚Äú3V3‚Äù (3.3V power)</li>
  <li>DA (signal - data), and</li>
  <li>CL (signal - clock).</li>
</ol>

<p>You need to connect these wires to the corresponding pins on the Thing.
See below pictures for how to connect both the Si7021 and FTDI Basic wifi module.</p>

<p><img src="/_images/tutorial_iot/temperature/img1.png" alt="Drawing" style="height: 400px;" /></p>

<p><img src="/_images/tutorial_iot/temperature/img2.png" alt="Drawing" style="height: 400px;" /></p>

<h3 id="the-arduino-code-and-related-installation-guide-of-necessary-packages">The Arduino code and related installation guide of necessary packages</h3>
<h4 id="install-the-necessary-libraries">Install the necessary libraries</h4>

<ol>
  <li>On your smartphone, install ‚ÄúBlynk‚Äù and register. It‚Äôs free.</li>
  <li>Download the Blynk library. Unzip it and move it to: C:\Users\user_name\Documents\Arduino\libraries</li>
  <li>The Si7021 requires another library to be installed.</li>
  <li>The library can be found here https://github.com/sparkfun/Si7021_Breakout</li>
</ol>

<p><img src="/_images/tutorial_iot/temperature/img3.png" alt="Drawing" style="height: 200px;" /></p>

<ol>
  <li>Unzip the downloaded folder and navigate to C:...\Si7021_Breakout-master\Si7021_Breakout-master\Libraries\Arduino</li>
  <li>Locate folder named Si7021 and copy over to C:\Users\user_name\Documents\Arduino\libraries</li>
</ol>

<p><img src="/_images/tutorial_iot/temperature/img4.png" alt="Drawing" style="height: 200px;" /></p>

<h4 id="install-the-blynk-application">Install the blynk application</h4>

<ol>
  <li>The blynk application must be installed and set up on the mobile device. The application can be found on the Google or Apple app stores.</li>
  <li>After the application is installed and has an account set up, then a new project can be started by selecting the large plus icon.</li>
</ol>

<p><img src="/_images/tutorial_iot/temperature/img5.png" alt="Drawing" style="height: 200px;" /></p>

<ol>
  <li>The Blynk authorization token is necessary to allow the FTDI device to communicate with the Blynk application. This token can be emailed or copied by selecting the project settings and selecting ‚ÄúEmail All‚Äù. The authorization token will be used in the code used in the next section.</li>
</ol>

<p><img src="/_images/tutorial_iot/temperature/img6.png" alt="Drawing" style="height: 400px;" /></p>

<ol>
  <li>Now it is time to setup a two virtual pins on Blynk. Tap on the background of the new project and from the menu select a ‚Äúvalue display‚Äù.</li>
</ol>

<p><img src="/_images/tutorial_iot/temperature/img7.png" alt="Drawing" style="height: 400px;" /></p>

<ol>
  <li>An empty box will display on the project screen, this can be selected and setup to collect the virtual pin data. Set the pin type to virtual and select V5 as the pin number for consistency with the code supplied in this example and name the pin ‚Äúhumidity‚Äù.</li>
</ol>

<p><img src="/_images/tutorial_iot/temperature/img8.png" alt="Drawing" style="height: 400px;" /></p>

<ol>
  <li>Repeat the previous two steps except select V6 and name it ‚ÄúTemperature‚Äù. When finished there should be two value displays setup.</li>
</ol>

<p><img src="/_images/tutorial_iot/temperature/img9.png" alt="Drawing" style="height: 400px;" /></p>

<ol>
  <li>Be sure to modify the given code with the authorization token, ssid, and password.</li>
</ol>

<h4 id="arduino-code-used-in-the-experiments">Arduino Code used in the experiments:</h4>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="code"><pre><span class="cp">#include &lt;Wire.h&gt;
#include &lt;ESP8266WiFi.h&gt;
#include &lt;BlynkSimpleEsp8266.h&gt;
</span>
<span class="c1">// SI7021 I2C address is 0x40(64)</span>
<span class="cp">#define si7021Add 0x40
</span>
<span class="c1">// You should get Auth Token in the Blynk App project settings.</span>
<span class="kt">char</span> <span class="n">auth</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"***"</span><span class="p">;</span> <span class="c1">//***Type in your Blynk Token</span>
 
<span class="c1">// Your WiFi credentials.</span>
<span class="c1">// Set password to "" for open networks.</span>
<span class="kt">char</span> <span class="n">ssid</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"***"</span><span class="p">;</span> <span class="c1">//***your wifi name</span>
<span class="kt">char</span> <span class="n">pass</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"***"</span><span class="p">;</span> <span class="c1">//***and password</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Blynk</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">ssid</span><span class="p">,</span> <span class="n">pass</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">si7021Add</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Blynk</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
 
  <span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">si7021Add</span><span class="p">);</span>
  <span class="c1">//Send humidity measurement command</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mh">0xF5</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Blynk</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
 
  <span class="c1">// Request 2 bytes of data</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">si7021Add</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="c1">// Read 2 bytes of data to get humidity</span>
  <span class="k">if</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">available</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="p">}</span>
 


  <span class="c1">// Convert the data</span>
  <span class="kt">float</span> <span class="n">humidity</span>  <span class="o">=</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">humidity</span> <span class="o">=</span> <span class="p">((</span><span class="mi">125</span> <span class="o">*</span> <span class="n">humidity</span><span class="p">)</span> <span class="o">/</span> <span class="mi">65536</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">6</span><span class="p">;</span>
 
  <span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">si7021Add</span><span class="p">);</span>
  <span class="c1">// Send temperature measurement command</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mh">0xF3</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Blynk</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
 
  <span class="c1">// Request 2 bytes of data</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">si7021Add</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="c1">// Read 2 bytes of data for temperature</span>
  <span class="k">if</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">available</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="p">}</span>
 
  <span class="c1">// Convert the data</span>
  <span class="kt">float</span> <span class="n">temp</span>  <span class="o">=</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="kt">float</span> <span class="n">celsTemp</span> <span class="o">=</span> <span class="p">((</span><span class="mi">175</span><span class="p">.</span><span class="mi">72</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span> <span class="o">/</span> <span class="mi">65536</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">46</span><span class="p">.</span><span class="mi">85</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">fahrTemp</span> <span class="o">=</span> <span class="n">celsTemp</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">32</span><span class="p">;</span>
 
  <span class="n">Blynk</span><span class="p">.</span><span class="n">virtualWrite</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">fahrTemp</span><span class="p">);</span>
  <span class="n">Blynk</span><span class="p">.</span><span class="n">virtualWrite</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">humidity</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Blynk</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>

  <span class="c1">//High Limit push notification, Blynk mobile app</span>
  <span class="k">if</span><span class="p">(</span><span class="n">fahrTemp</span> <span class="o">&gt;</span> <span class="mi">85</span><span class="p">)</span> <span class="p">{</span> <span class="n">Blynk</span><span class="p">.</span><span class="n">notify</span><span class="p">(</span><span class="s">"Temperature is high"</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">humidity</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">)</span> <span class="p">{</span> <span class="n">Blynk</span><span class="p">.</span><span class="n">notify</span><span class="p">(</span><span class="s">"Humidity is high"</span><span class="p">);</span> <span class="p">}</span>
  <span class="n">Blynk</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="experiment-and-discussion">Experiment and Discussion</h3>

<p>The weather sensor senses the Temperature and humidity of the atmosphere it is placed in. It can therefore be used to study the weather of atmosphere or conditioned room or even be used as a sensor for the an electronic equipment, becoming a safety device.</p>

<h4 id="experiment-1">Experiment 1:</h4>

<p>In this experiment the sensor coupled with Arduino board is run in a loop to read the values of the temperature and humidity. The values are read using the Blynk app on a smartphone. A predefined high limit value is set for the temperature and humidity, so that a push notification is received on a mobile device on which Blynk is running.</p>

<p><img src="/_images/tutorial_iot/temperature/img10.png" alt="Drawing" style="height: 400px;" />
<img src="/_images/tutorial_iot/temperature/img11.png" alt="Drawing" style="height: 400px;" />
<img src="/_images/tutorial_iot/temperature/img12.png" alt="Drawing" style="height: 400px;" /></p>

<h4 id="experiment-2">Experiment 2:</h4>

<p>Another experiment is to set the sensor outdoors and measure the temperature and humidity and compare it against a weather application, such as The Weather Channel.</p>

<p>First the weather report was obtained from the weather application. At the time of experiment, the Temperature was 53 degrees fahrenheit, and the humidity was 77%.
The sensor was placed in open air to sense the weather. After allowing a few minutes for the sensor to adjust to the temperature and humidity, the reading was quite close to the application temperature and humidity. The sensor read 77.5% humidity and 53.1 degrees fahrenheit to the Blynk application.</p>

<p><img src="/_images/tutorial_iot/temperature/img13.png" alt="Drawing" style="height: 400px;" />
<img src="/_images/tutorial_iot/temperature/img14.png" alt="Drawing" style="height: 400px;" />
<img src="/_images/tutorial_iot/temperature/img15.png" alt="Drawing" style="height: 400px;" /></p>

:ET