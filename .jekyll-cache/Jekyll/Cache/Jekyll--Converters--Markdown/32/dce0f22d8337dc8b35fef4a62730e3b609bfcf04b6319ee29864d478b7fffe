I"˝ä<h1 id="ansys-doe-and-design-optimization-tutorial">ANSYS DOE and Design Optimization Tutorial</h1>
<p>by Max Yi Ren and Aditya Vipradas</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#example">A Running Example</a>
    <ol>
      <li><a href="#brake">Description of the brake design problem</a></li>
      <li><a href="#structural">Static structural setup</a></li>
      <li><a href="#modal">Modal setup</a></li>
      <li><a href="#thermal">Transient thermal setup</a></li>
      <li><a href="#transfer">Transfering geometry and model across analysis modules</a></li>
      <li><a href="#input">Define input parameters</a></li>
    </ol>
  </li>
  <li><a href="#background">Background Knowledge</a></li>
  <li><a href="#doe">Design of Experiments</a></li>
  <li><a href="#sensitivity">Sensitivity Analysis</a></li>
  <li><a href="#optimization">Optimization</a></li>
  <li><a href="#checklist">Checklist</a></li>
</ol>

<hr />

<h2 id="introduction-">Introduction <a name="introduction"></a></h2>

<p>This is a step-by-step tutorial of the ANSYS Design of Experiment (DOE) and Optimization tools. 
These tools will allow you to better validate and understand your engineering model and further 
refine your design for specific properties of interest. We will skip some mathematical details 
but focus on explaining how things should be done.</p>

<p>We encourage you to also read related chapters in 
the official <a href="https://www.scribd.com/document/355011614/Design-Exploration-Users-Guide">ANSYS Design Exploration User‚Äôs Guide</a>.</p>

<p><strong>NOTE</strong>: This tutorial is tested on ANSYS 16, 17.1 and 17.2.</p>

<hr />

<h2 id="a-running-example-">A Running Example <a name="example"></a></h2>
<p>Before we start, please prepare the CAD model of your design and determine attributes that you want to design for.
You can also use the following sample problem on vehicle brake design. 
The model file of the brake can be downloaded <a href="/_images/tutorial_ansys/brake.agdb">here (.agdb)</a>. The raw model is <a href="/_images/tutorial_ansys/brake_Geom.stp">here (.stp)</a>. 
All credits go to A. Durgude, A. Vipradas, S. Kishore, and S. Nimse 
(see their <a href="http://designinformaticslab.github.io/_teaching//designopt/projects/2016/desopt_2016_04.pdf">MAE598 Design Optimization project report (2016)</a>).</p>

<h3 id="description-of-the-brake-design-problem-">Description of the brake design problem <a name="brake"></a></h3>
<p>To summarize, the brake design problem has the following objectives:</p>

<ul>
  <li>Design a brake disc for emergency braking conditions with minimal volume</li>
  <li>Minimize the maximum stress in the brake disc</li>
  <li>Maximize the first natural frequency of the brake disc</li>
  <li>Minimize the maximum temperature in the brake disc</li>
</ul>

<p>The three subsystems are as follows:</p>

<ul>
  <li>
    <p>Structural Analysis: The brake disc has to sustain the pressure from the 
hydraulically actuated brake pads during sudden braking conditions. Stresses are induced 
due to friction between the brake pads and the disc. The disc also experiences centrifugal 
body forces due to its rotation. Resultant stresses generated due these forces can lead to
material failure. Therefore, it is of prime importance to make sure that the stresses in 
the disc are minimized.</p>
  </li>
  <li>
    <p>Modal Analysis: Free modal analysis is performed to ensure that the 
disc‚Äôs first natural frequency is higher than the engine firing frequency. This guarantees 
that the disc does not experience failure due to resonance.</p>
  </li>
  <li>
    <p>Thermal Analysis: Braking in a vehicle takes place due to friction 
between the brake pads and the rotor disc. This leads to heat flux generation in the disc 
which consequently results in increase in its temperature and thermal stresses. Emergency 
braking conditions induce high temperatures that damage the contact surfaces. It is therefore 
essential to minimize the temperature to prevent disc wear and tear.</p>
  </li>
</ul>

<p>The following sections describes how these analysis are set up.</p>

<h3 id="static-structural-setup-">Static structural setup <a name="structural"></a></h3>
<ul>
  <li><strong>Define Material</strong>: In Project Schematic, click on <strong>Engineering Data</strong>, 
 then click <strong>Engineering Data Sources</strong>-&gt;<strong>General Materials</strong>, from the list, find ‚ÄúGray Cast Iron‚Äù and click 
 the ‚Äúadd‚Äù button (the plus sign). The sign with a blue book will appear <strong>after</strong> we assign this material to 
  an object.</li>
</ul>

<p><img src="/_images/tutorial_ansys/material.png" alt="Drawing" style="height: 500px;" /></p>

<ul>
  <li>
    <p><strong>Load Geometry</strong>: In Project Schematic, click on <strong>Geometry</strong>, then create geometry in <strong>DesignModeler</strong> 
  or import a agdb file.</p>
  </li>
  <li>
    <p><strong>Mesh the Geometry</strong>: In Project Schematic, double click on Model to open the Mechanical screen.
 To setup the mesh: Right click Mesh -&gt; Method -&gt; Select all the bodies and 
 then select Tetrahedrons in Method option</p>
  </li>
</ul>

<p><img src="/_images/tutorial_ansys/structural.png" alt="Drawing" style="height: 200px;" /></p>

<ul>
  <li>Right click Mesh -&gt; Sizing -&gt; Select inner faces of the brake pads and set element size to 3 mm. 
 This is because the pad is relatively thin, and has higher stress concentration than other places. Therefore
finer mesh will give us more accurate simulation result. <strong>NOTE</strong>: For student version, you may not be able
to run the simulation if the mesh size is higher than the limitation.</li>
</ul>

<p><img src="/_images/tutorial_ansys/structural2.png" alt="Drawing" style="height: 200px;" /></p>

<ul>
  <li><strong>Assign Material</strong>: Still in the Mechanical screen, notice the two parts under <strong>Geometry</strong> in the outline window.
 These are the brake disk and the brake pads. Assign material types by clicking on each, and go to 
 the <strong>Details</strong> window below the outline, find <strong>Material</strong>-&gt;<strong>Assignment</strong>, choose Gray Cast Iron for the disk,
 and Structural Steel for the pads.</li>
</ul>

<p><img src="/_images/tutorial_ansys/material2.png" alt="Drawing" style="height: 300px;" /> 
 <img src="/_images/tutorial_ansys/material3.png" alt="Drawing" style="height: 300px;" /></p>

<ul>
  <li><strong>Define Boundary Conditions</strong>: Right click Static Structural -&gt; Insert -&gt; Rotational Velocity -&gt; 
 Set 250 rad/s to the y-axis of the brake disk.</li>
</ul>

<p><img src="/_images/tutorial_ansys/structural3.png" alt="Drawing" style="height: 300px;" /> 
 <img src="/_images/tutorial_ansys/structural31.png" alt="Drawing" style="height: 300px;" /></p>

<ul>
  <li>Right click on Connections, create a Revolute Joint. Set up the joint as shown below: In 
 Details, choose ‚ÄúBody-Ground‚Äù for ‚Äúconnection type‚Äù, choose the highlighted (blue) circle
 for ‚Äúscope‚Äù.</li>
</ul>

<p><img src="/_images/tutorial_ansys/contact.png" alt="Drawing" style="height: 400px;" /></p>

<ul>
  <li>Right click Static Structural -&gt; Insert -&gt; Pressure -&gt; Enter the values as shown by selecting 
 the outer brake pad faces. Do this for each outer brake pad face.</li>
</ul>

<p><img src="/_images/tutorial_ansys/structural4.png" alt="Drawing" style="height: 200px;" /></p>

<ul>
  <li>Click on Connections-&gt;Contacts in the outline window, and right click to add <strong>Manual Contact Region</strong>. 
 Set up a frictional contact as shown below. Do this for both contact regions between the pads and the disk.</li>
</ul>

<p><img src="/_images/tutorial_ansys/joint.png" alt="Drawing" style="height: 400px;" /></p>

<ul>
  <li>Right click Static Structural -&gt; Insert -&gt; Displacement -&gt; Fix x- and z-axis displacement of all the 
 faces of brake pads</li>
</ul>

<p><img src="/_images/tutorial_ansys/structural5.png" alt="Drawing" style="height: 300px;" /></p>

<ul>
  <li>Select the desired output values and solve by right clicking on Solution and hitting Solve. Set Equivalent von-Mises stress as output parameter.</li>
</ul>

<p><img src="/_images/tutorial_ansys/structural6.png" alt="Drawing" style="height: 400px;" /></p>

<ul>
  <li>Note that the solution is sensitive to various settings, including mesh size, nonlinear and thermal strain effects of the chosen
 materials, and whether large deflection is considered.</li>
</ul>

<h3 id="modal-setup-">Modal setup <a name="modal"></a></h3>
<ul>
  <li>Drag Modal Analysis box on the Geometry of Static Structural box. Same geometry and mesh settings as discussed earlier.</li>
  <li>Right click Brake pad parts in Geometry -&gt; Click Suppress (We want the natural frequency of the brake disc only)</li>
  <li>Click Analysis Settings and enter ‚ÄúMax Modes to Find‚Äù as 10</li>
</ul>

<p><img src="/_images/tutorial_ansys/modal1.png" alt="Drawing" style="height: 200px;" /></p>

<ul>
  <li>Right click Solution -&gt; Insert -&gt; Deformation -&gt; Total -&gt; Enter the desired mode number.
  The first 6 modes are the rigid body modes. We do not need those. Parametrize the frequency of mode 7 which is the first deformation mode.</li>
</ul>

<p><!--<img src="/_images/tutorial_ansys/modal2.png" alt="Drawing" style="height: 300px;"/> --></p>

<p><img src="/_images/tutorial_ansys/modal3.png" alt="Drawing" style="height: 300px;" /></p>

<h3 id="transient-thermal-setup-">Transient thermal setup <a name="thermal"></a></h3>
<ul>
  <li>Drag Transient Thermal box on the Geometry tab of the Static Structural box.</li>
  <li>Same Geometry and Mesh settings as Static Structural. Suppress brake pad geometry as explained in the Modal module.</li>
  <li>Under Transient Thermal click ‚ÄúInitial Temperature‚Äù and set the value to 35C.</li>
</ul>

<p><img src="/_images/tutorial_ansys/thermal1.png" alt="Drawing" style="height: 100px;" /></p>

<ul>
  <li>Click on ‚ÄúAnalysis Settings‚Äù and set up the values as shown.</li>
</ul>

<p><img src="/_images/tutorial_ansys/thermal2.png" alt="Drawing" style="height: 300px;" /></p>

<ul>
  <li>Right click Transient Thermal -&gt; Insert -&gt; Convection -&gt; Select all the brake disc faces and set the values as shown.</li>
</ul>

<p><img src="/_images/tutorial_ansys/thermal3.png" alt="Drawing" style="height: 300px;" /></p>

<ul>
  <li>Right click Transient Thermal -&gt; Insert -&gt; Heat flux -&gt; Select the face as shown and enter the values</li>
</ul>

<p><img src="/_images/tutorial_ansys/thermal4.png" alt="Drawing" style="height: 200px;" /> 
 <img src="/_images/tutorial_ansys/thermal5.png" alt="Drawing" style="height: 200px;" /></p>

<ul>
  <li>Repeat this for the faces on the other side of the brake disc</li>
</ul>

<p><img src="/_images/tutorial_ansys/thermal6.png" alt="Drawing" style="height: 200px;" /></p>

<ul>
  <li>Right click Solution -&gt; Insert -&gt; Thermal -&gt; Temperature, parameterize and solve</li>
</ul>

<p><img src="/_images/tutorial_ansys/thermal7.png" alt="Drawing" style="height: 300px;" /></p>

<h4 id="transfering-geometry-and-model-across-analysis-modules-">Transfering geometry and model across analysis modules <a name="transfer"></a></h4>
<p>Consider that you have performed a Static Structural Analysis, you can use the mesh created 
from this analysis to perform another analysis, say a modal analysis. The followings steps
show how this is done.</p>

<ol>
  <li>
    <p>To copy the geometry to another analysis</p>
  </li>
  <li>
    <p>Hold on the Modal module</p>
  </li>
</ol>

<p><img src="/_images/tutorial_ansys/share1.png" alt="Drawing" style="height: 100px;" /></p>

<ol>
  <li>Drag onto the tab of the Static Structural Module</li>
</ol>

<p><img src="/_images/tutorial_ansys/share2.png" alt="Drawing" style="height: 300px;" /></p>

<ol>
  <li>The geometry is shared</li>
</ol>

<p><img src="/_images/tutorial_ansys/share3.png" alt="Drawing" style="height: 300px;" /></p>

<p>This is generally performed when two different analyses are to be performed on the same geometry. You will have to do the mesh again.</p>

<ol>
  <li>
    <p>To share the mesh, boundary conditions setup and results</p>
  </li>
  <li>
    <p>Hold on the Modal module</p>
  </li>
  <li>
    <p>Drag on the Model or Solution tab of the Static Structural module</p>
  </li>
</ol>

<p><img src="/_images/tutorial_ansys/share4.png" alt="Drawing" style="height: 300px;" /></p>

<ol>
  <li>The mesh, setup and results are shared</li>
</ol>

<p><img src="/_images/tutorial_ansys/share5.png" alt="Drawing" style="height: 300px;" /></p>

<p>This is generally performed when results from one analysis are to be shared with another 
analysis. For instance, these steps can be used to perform pre-stressed modal analysis 
where results from static structural analysis are shared with modal analysis.</p>

<p><strong>NOTE</strong>: You have only these two options. There is no option to just share the mesh.</p>

<h3 id="define-input-parameters-">Define input parameters <a name="input"></a></h3>

<p>The input parameters are the design variables. To set these up, click on the Geometry tab of the static structural box.
Parametrize the outer diameter, inner diameter and thickness of the brake disc. Click on Sketch 1 as shown.</p>

<p><img src="/_images/tutorial_ansys/input1.png" alt="Drawing" style="height: 200px;" /></p>

<p>Select the dimensions as input parameters as shown in the figure by hitting the checkbox.</p>

<p><img src="/_images/tutorial_ansys/input2.png" alt="Drawing" style="height: 200px;" /></p>

<hr />

<h2 id="background-knowledge-for-doe-and-optimization-">Background Knowledge for DOE and Optimization <a name="background"></a></h2>
<p>We first need to define some terminologies for a design problem:</p>

<ul>
  <li><strong>Parameters</strong>: These include all available ‚Äúnobs‚Äù for your 
design, e.g., geometry, topology, materials, and control gains.</li>
  <li><strong>Variables</strong>: These are the subset of design parameters that you want to tune 
(so the rest of the parameters are fixed during the design). The set of all possible variable settings
is called the design space.</li>
  <li><strong>Objectives</strong>: An objective defines the goodness of a design. This is 
usually some performance of the design that you care about (safety of a car, stability of a controller, etc.). 
In many cases, we are interested in designing for more than one objective. However, to make things easier, 
our discussion will be focused on a single objective. We will talked about how multiple objectives can be handled.</li>
  <li><strong>Constraints</strong>: These are functions of the design variables that define a feasible variable space.
E.g., the design of a bridge has to have a maximum stress less than the critical stress (times a safety 
factor).</li>
</ul>

<p><em>NOTE</em>: In ANSYS and some other software, the difference between <strong>parameters</strong> and <strong>variables</strong>
is not distinguished. So when you see ‚Äúparameters‚Äù, it might actually mean ‚Äúvariables‚Äù.</p>

<p><img src="/_images/tutorial_ansys/summary.png" alt="Drawing" style="height: 400px;" /></p>

<p><strong>Optimization</strong> is the iterative process for finding a design that maximizes or minimizes the objective by 
searching the design space. There are two major schools of optimization algorithms: <em>gradient-based methods</em> 
 are useful when the objective is differentiable (in many mathematical and machine learning problems). They are fast
  but can only find local solutions; <em>Gradient-free methods</em> are useful when the evaluation of the objective 
  (and its gradient) is expensive or when the gradient is noisy. Ansys offers both options.</p>

<p><img src="/_images/tutorial_ansys/local.png" alt="Drawing" style="height: 300px;" /></p>

<p><strong>DOE</strong>: Many engineering design problems have objectives that are evaluated through expensive simulations/experiments,
e.g., CFD analysis. In such cases, each function evaluation during the optimization takes a long time, 
and thus could making the optimization intractable. DOE is a set of methodologies that determine which design to evaluate from a potentially large design space,
so that we can create a statistical model to predict the objective values of other designs
with low uncertainty in prediction. Through the predictive model, we can also tell the sensitivity of variables,
i.e., whether the objective changes much with respect to each of the variables. DOE is often used as part 
of the gradient-free optimization algorithm.</p>

<!--The design optimization methodology flowchart is as shown in the figure. -->
<!--<img src="/_images/tutorial_ansys/flow.JPG" alt="Drawing" style="height: 400px;"/>-->

<hr />

<h2 id="design-of-experiments-">Design of Experiments <a name="doe"></a></h2>
<p>DOE is used to effectively sample a design space (e.g., all design parameters for the
 brake disc) so that a statistical model can be built to predict responses (e.g., 
 the maximum stress, or the first natural frequency, or the maximum temperature) of a given 
 design. DOE is useful when one can only sample a limited number of points (i.e., run a 
 limited number of simulations). The key idea of DOE is to ``spread out‚Äô‚Äô the samples 
 so that the resultant statistical model has low uncertainty in its model estimation 
 and thus high accuracy in prediction.</p>

<h3 id="step-1-define-parameters-and-responses">Step 1: Define parameters and responses</h3>
<p>To conduct DOE for a given model, we shall 
first define the list of design variables and objectives that we care about (In Ansys, these are called
<em>input</em> and <em>output</em> parameters). To do so, open the ‚ÄúProject Schematic‚Äù window, which shall look like this:</p>

<p><img src="/_images/tutorial_ansys/setparameter.png" alt="Drawing" style="height: 500px;" /></p>

<h3 id="step-2-choose-a-design-exploration-method">Step 2: Choose a Design Exploration method</h3>
<p>In the Design Exploration window, find ‚ÄúResponse Surface‚Äù. 
This will allow us to perform DOE for the purpose of creating a predictive model, called a response surface.
Drag the ‚ÄúResponse Surface‚Äù tab from the Toolbox on any one dashed box near ‚ÄúParameter Set‚Äù.</p>

<p><img src="/_images/tutorial_ansys/responsesurface.png" alt="Drawing" style="height: 300px;" /></p>

<h3 id="step-3-choose-a-doe-method-">Step 3: Choose a DOE method <a name="doemethod"></a></h3>
<p>While ANSYS provides various DOE methods, we suggest 
<em>Latin Hypercube Sampling</em> (LHS) and <em>Optimal space filling</em> with user defined sample points. 
The main advantage of these methods is that the number of samples is independent from the number of parameters. Another 
(more advanced) choice is <em>sparse grid</em>, which only samples a few points initially and adaptively add
 new sample points based on the response surface. <em>Kriging with auto-refinement</em> has a similar effect.
Note, we do not recommend <em>Central Composite Design (CCD)</em> because in many cases, the objective cannot be 
approximated as a quadratic function, and CCD requires a large number of samples for relatively small
number of variables.</p>

<p>Click on the ‚ÄúDesign of Experiments‚Äù option and select the required DOE and Design type:</p>

<p><img src="/_images/tutorial_ansys/doetype.png" alt="Drawing" style="height: 400px;" /></p>

<p>If you double click on the ‚ÄúDesign of Experiments‚Äù tab, a new window opens where you see your 
input and output parameters.</p>

<p><img src="/_images/tutorial_ansys/doepara.png" alt="Drawing" style="height: 400px;" /></p>

<p>You can set the lower and upper bounds of each input parameter by clicking on that parameter.</p>

<p><img src="/_images/tutorial_ansys/setbounds.png" alt="Drawing" style="height: 400px;" /></p>

<p>After setting the input parameter bounds, hit ‚ÄúPreview‚Äù to see the list of DOE points according to your 
settings.</p>

<p><img src="/_images/tutorial_ansys/doepreview.png" alt="Drawing" style="height: 400px;" /> 
 <img src="/_images/tutorial_ansys/doepreview2.png" alt="Drawing" style="height: 400px;" /></p>

<p>Now hit ‚Äúupdate‚Äù and brew your coffee. Depending on how many samples you requested, it will
take hours to days for DOE to finish.</p>

<p><strong>NOTE</strong>: Some of your DOE samples may not be evaluated successfully due to significant change
in geometry. In the brake disk example, if the outer radius of the disk is changed to be
smaller than the outer radius of the pads, the friction contact setting will need to be reset
manually due to mesh change. When this happens, it could indicate that some of the designs
sampled by DOE are not meaningful, e.g., having the brake pads partially cover the disk is
not a good design after all. It could also happen that you do want to evaluate these designs.
To do so, first manually fix issues due to parameter changes, and run the simulation(s) manually.
You can then download the current DOE results, add in these manually derived data, and upload the
data table to ANSYS.</p>

<h3 id="step-4-create-a-response-surface-">Step 4: Create a response surface <a name="response"></a></h3>
<p>The DOE results can be used to create a response surface for prediction purpose. 
ANSYS provides the following list of response surface methods:</p>

<ul>
  <li><strong>Standard Response Surface</strong>: This method uses a polynomial surface to fit the data. It requires
the least amount of computation in both fitting and prediction. However, the performance of 
the prediction largely depend on the choice of the polynomial bases. <strong>Use this method when you have
lots of data and the change in objective is smooth.</strong></li>
  <li><strong>Kriging</strong>: This method is non-parametric, meaning that the prediction will depend on all 
existing data points. Thus the method could be slow in prediction when you have a large amount data to fit.
It is also slow in fitting the data due to the calculation of pair-wise distances among data points.
However, this method automatically fits through all data points. <strong>Use this method when your data
is highly nonlinear and limited, and you want your model to fit right through your data (i.e., you 
trust your simulation results)</strong>.</li>
  <li><strong>Non-parametric Regression</strong>: This method uses Support Vector Regression. It is similar to Kriging
in that the prediction depends on current data. But instead of using all data, this method chooses the
most important data points to perform prediction. Thus its computation cost for prediction is less than
that of Kriging. Yet, its cost of fitting is still high. The model does not fit through the data. 
<strong>Use this method when your data is highly nonlinear, and you don‚Äôt need your model to fit right
 through your data.</strong></li>
  <li><strong>Neural Network</strong>: Feedforward neural network creates a nonlinear mapping from the input (a design) to the 
output (its objective value) that mimics the expensive simulation. It is slow in training (and may
end up with a different model each time you train, even if the data is the same) when the network is
deep, but the prediction only involves simple matrix calculation and is fast. 
<strong>Use this method when your data is highly nonlinear but you have lots of them, and you don‚Äôt need
your model to fit right through your data</strong>.</li>
  <li><strong>Sparse Grid</strong>: This method goes with the corresponding DOE method. It is similar to Kriging in
that it handles highly non-linear objectives. It does so by adaptively sampling in the most uncertain
areas of the design space, and thus may reduce the number of samples needed. <strong>Use this method when 
the objective is highly nonlinear and you cannot afford many simulations</strong></li>
</ul>

<p>To create a response surface, click on the ‚ÄúResponse Surface‚Äù option in the Project Schematic window:</p>

<p><img src="/_images/tutorial_ansys/response1.png" alt="Drawing" style="height: 200px;" /></p>

<p>A new window opens. Choose the type of response surface you need. 
And then hit on the ‚ÄúUpdate‚Äù button.</p>

<!--***One can visualize the resultant response surface model in .... For models with more than 2 input -->
<!--parameters, .... One can also check the goodness of fit of the response surface model by .... -->
<!--For example, the goodness of fit plots for the structural analysis of the brake disc is shown below.***-->

<h3 id="common-issues-in-doe-and-response-surface-">Common issues in DOE and response surface <a name="commonissues"></a></h3>

<p><strong>My model has a bad fit, what shall I do?</strong>: There are two ways to improve the goodness of fit: (1) increase the sample size 
in DOE; and (2) increase the ‚Äúcomplexity‚Äù of the response surface. To perform the latter, one can 
simply choose a high-order polynomial model or a non-parametric model such as <strong>Kriging</strong> and 
<strong>Non-parametric Regression</strong>.</p>

<p><strong>Wow, now my model has a perfect fit, is that good?</strong>: The short answer is NO. 
While increasing the ‚Äúcomplexity‚Äù lowers the ‚Äútraining error‚Äù, i.e., the error between the model and
the data used to train the model, it is not recommended to use this 
method to push the goodness of fit to the limit. In fact, with non-parametric models, it is always possible
to perfectly fit through all data points (one can always connect all dots manually). 
But by doing this, we may very likely <strong>overfit</strong> the model, 
so that it actually has worse <strong>prediction</strong> performance than a 
model with higher training error. 
To summarize the theory behind this, <em>A model has better prediction performance when:
the training error is low, and the model complexity is also low</em>. 
Note that this is essentially what <strong>Occam‚Äôs Razor</strong> says.</p>

<!--<img src="/_images/tutorial_ansys/reg1.jpg" alt="Drawing" style="height: 400px;"/>-->

<p><strong>So how can we determine which model is the best?</strong> A common practice is to use a judge, or called <strong>verification 
points</strong>. The idea is to set some data we collected aside, and never use them for
training the model, but only use them for calculating the error, which is called the validation error. The rationale 
is that if the model can fit well with these data without using them for training, then it has good predictability.</p>

<p>To perform verification in Ansys, click on the ‚ÄúResponse Surface‚Äù as shown in the figure below. 
Check ‚ÄúGenerate Verification Points‚Äù and enter the number of verification points. There is not really a rule on 
how many verification points you should use, but 1/4 or 1/3 of your total sample size is practically reasonable.</p>

<p><img src="/_images/tutorial_ansys/verification.png" alt="Drawing" style="height: 400px;" /></p>

<p><strong>What if my verification result is bad?</strong> This can commonly happen if (1) your sample size
is small, or (2) the underlying response is highly nonlinear, or (3) the choice of response surface
is too flexible (e.g., Kriging), thus causing overfit. To address this issue, you can (1) increase the sample size, 
(2) try a different model. Note that in ANSYS, you can include the verfication points as refinement points, which will 
lead to better goodness of fit. To do so, right click on the verification point. One shall then increase the number of 
verification points in the response surface setting before updating the response surface (or otherwise
all points are used for fitting the response surface, leading to overfitting again).</p>

<p><strong>When shall I stop refinement?</strong> If the goal of creating the response surface is solely to 
use the surface for predicting responses, then one shall make sure that with enough verification
points, the error in prediction is limited. ANSYS provides a three-star rating on the goodness of fit
 of the response surface for verification points for this purpose.</p>

<p>If the goal is to perform optimization, an accurate response surface is not necessary. Therefore 
 with a relatively accurate surface model, one can move on to the optimization. Since the optimization
 is performed based on the response surface rather than the true simulations, a discrepancy
 may exist between the predicted and the true responses. ANSYS reports both numbers for the set of 
 near-optimal solutions it finds. If the discrepancy is significant, one shall set these solutions
  as refinement points of the response surface, and run optimization again upon the refined surface.
 A smarter approach is the Bayesian Optimization algorithm. For interested readers, see <a href="https://arxiv.org/pdf/1012.2599.pdf?bcsi_scan_dd0fad490e5fad80=fwQqmV5CfHDAMm8dFLewPK+h1WGiAAAAkj1aUQ%3D%3D&amp;bcsi_scan_filename=1012.2599.pdf&amp;utm_content=buffered388&amp;utm_medium=social&amp;utm_source=plus.google.com&amp;utm_campaign=buffer">this review of BO</a>.</p>

<p>** What is verification and validation?**: ‚ÄúValidation‚Äù is often referred to as testing a design in reality (with experiments) while
‚Äúverification‚Äù means testing the design with simulations.</p>

<!--**But there are so many choices of models, what shall I do???** -->
<!--The good practice for building response surface models is as follows: First, look at the -->
<!--visualization of the DOE data and see if a polynomial function can reasonably explain the data. -->
<!--For example, the data in the following figure is smooth and can be approximated by .... -->
<!--In such cases, choose to use a polynomial model. Otherwise, choose Kriging or .-->

<h2 id="sensitivity-analysis-">Sensitivity Analysis <a name="sensitivity"></a></h2>
<p>Building the response surface also allows us to perform sensitivity analysis, i.e., to see how much the objective
changes when each variable changes. When a large number of variables exist, sensitivity analysis allows us to figure
out the most important variables to design for, and thus reduce the computational cost of the optimization.</p>

<p>To perform sensitivity analysis, go to the ‚ÄúResponse Surface‚Äù tab. 
The options for the sensitivity analysis are as shown in the figure below.</p>

<p><img src="/_images/tutorial_ansys/sensitivity1.png" alt="Drawing" style="height: 400px;" /></p>

<p>Here, ‚ÄúLocal Sensitivity‚Äù shows the norm of the partial derivatives of the chosen objective 
with respect to the selected variables:</p>

<p><img src="/_images/tutorial_ansys/sensitivity2.png" alt="Drawing" style="height: 200px;" /></p>

<p>‚ÄúLocal Sensitivity Curves‚Äù shows the response curve of the chosen objective
 (Y-axis) with respect to the selected variables (X-axis):</p>

<p><img src="/_images/tutorial_ansys/sensitivity3.png" alt="Drawing" style="height: 200px;" /></p>

<hr />

<h2 id="optimization-">Optimization <a name="optimization"></a></h2>
<!--Optimization is about tuning the design parameters iteratively until the maximum (-->
<!--or minimum) of the response(s) of interest -->
<!--are reached. An optimization problem requires three elements: The {\it objective(s)} are -->
<!--the responses to be maximized (or minimized); the {\it variables} are the design parameters -->
<!--that the objective is sensitive to; the {\it constraints} are the responses that need to -->
<!--be within certain bounds. In ANSYS, these elements can be set up in ***.  -->

<h3 id="single-objective-vs-multi-objective">Single-objective vs. Multi-objective</h3>
<p>There is rarely a design case where we only want to optimize a single response. 
In the running example, a set of objectives are listed. However, finding a Utopian design 
that simultaneously optimizes all objectives is unachievable in reality. This is because 
for a reasonable problem setting, there always exist conflicts among objectives. 
There are two solutions to this: (1) One can set one of the objectives as the objective in 
ANSYS, and the rest as constraints. By changing the constraints, one can derive a sequence 
of optimal solutions. This set of solutions is call <strong>Pareto Optimal</strong>, and a surface spanned 
in the space of objectives fitting through these solutions is call the <strong>Pareto frontier</strong>. 
For cases with two (three) objectives, it is called the <strong>Pareto curve</strong> (<strong>Pareto surface</strong>). 
Deriving the Pareto frontier is often more valuable than obtaining a single optimal solution, 
since the former reveals quantitatively how conflicting objectives trade off for the design 
problem of interest.
% need a figure here.</p>

<h3 id="optimization-algorithms">Optimization algorithms</h3>
<p>ANSYS provides a list of optimization algorithms:</p>

<ul>
  <li><strong>Screening</strong>: Randomly sampling the space and pick out the good ones. 
Use this as an initial trial to make sure everything is setup correctly, e.g., does your simulation
give reasonable results?</li>
  <li><strong>Multiobjective Genetic Algorithm (MOGA)</strong>: Simultaneously find Pareto-optimal designs. Use this 
when you have multiple objectives. This is not the only choice for this situation though, see discussion above.</li>
  <li><strong>Nonlinear Programming by Quadratic Lagrangian (NLPQL)</strong>: Fast local search. Use this when (1) there is
only one objective (but you can set other objectives as constraints), (2) the simulation does not take
too long (in minutes), (3) the number of variables is small (less than 10).</li>
  <li><strong>Mixed-Integer Sequential Quadratic Programming (MISQP)</strong>: Similar to NLPQL, but allows integer variables. Note that 
the addition of integer variables will often significantly increase the computation time.</li>
  <li><strong>Adaptive Single-Objective Optimization (ASO)</strong>: This method uses Optimal Space Filling for DOE, Kriging as a
response surface, and MISQP for finding local optimal solutions from the response surface. Use this when the 
evaluation of objective/constriants are expensive and you have limited budget/time for optimization.</li>
  <li><strong>Adaptive Multi-Objective Optimization (AMO)</strong>: Similar to ASO, this one uses Kriging and MOGA.</li>
</ul>

<hr />

<h2 id="things-to-check-during-your-analysis-and-optimization-">Things to check during your analysis and optimization <a name="checklist"></a></h2>
<ul>
  <li>
    <p>What are your design variables, constraints, and objectives?</p>
  </li>
  <li>
    <p>What are the potential trade-offs between your objectives?</p>
  </li>
  <li>
    <p>Are your variables continuous? Or are they discrete/integer?</p>
  </li>
  <li>
    <p>Do you have analytical objective/constraint functions? And are they differentiable?</p>
  </li>
  <li>
    <p>Based on the above answers, what optimization methods will you choose?</p>
  </li>
  <li>
    <p>Perform a sensitivity analysis and comment on the importance of your variables? 
Also, do you observe monotonicity (i.e., the objective always goes up or down with a variable)?</p>
  </li>
  <li>
    <p>Compare your optimal design against the initial one (e.g., see
the following comparison on the brake disc design) AND comment on whether the optimal design is reasonable.</p>
  </li>
</ul>

<p><img src="/_images/tutorial_ansys/prepostopt.png" alt="Drawing" style="height: 400px;" /></p>

:ET