I"C<p>This is a brief description of the
Equivalent Consumption Minimization Strategy (ECMS) code provided by
Dr. <a href="http://www.aebayrak.com/">Emrah Bayrak</a>. The code can be downloaded <a href="/_teaching/designopt/ECMS.zip">here</a>. The entrance
file is <code class="language-plaintext highlighter-rouge">fMPG.m</code>.</p>

<h2 id="description-of-files">Description of files</h2>
<p>Below are descriptions of all files. For instructions on the modification,
see the next section.</p>

<h3 id="files-that-need-modification">Files that need modification</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">fMPG.m</code>: This file takes in a <code class="language-plaintext highlighter-rouge">gear_ratio</code> (scalar) and a
drive <code class="language-plaintext highlighter-rouge">cycle</code> name (string). To run the code, please prepare a
drive cycle as a .mat file. This file should contain a matrix
with variable name <code class="language-plaintext highlighter-rouge">cyc_mph</code>. The matrix has two columns: the
first column has time steps (starting with 0), the second has
the corresponding velocity values. The outputs are the optimal fuel consumption
(gram) and MPG. The final state of charge (SOC) can be found from the variable <code class="language-plaintext highlighter-rouge">SOC_fin</code>.
Desired SOC is set by <code class="language-plaintext highlighter-rouge">SOC_des</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hybrid_ECMS_ATC.m</code>: Main file for the ECMS algorithm.
The function outputs <code class="language-plaintext highlighter-rouge">MPG</code>, final SOC (<code class="language-plaintext highlighter-rouge">SOC_fin</code>),
fuel consumption along time (<code class="language-plaintext highlighter-rouge">FC_plot</code>), SOC along time (<code class="language-plaintext highlighter-rouge">SOC_plot</code>),
Mode shifting along time (<code class="language-plaintext highlighter-rouge">Mode_plot</code>, obsolete for single mode powertrain),
time array (<code class="language-plaintext highlighter-rouge">t_array</code>), and whether
the powertrain mode is feasible for the given drive cycle (<code class="language-plaintext highlighter-rouge">ISfeas</code>).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hev_vehicle.m</code>: Defines all vehicle parameters. <strong>You will need to
modify this file for your vehicle.</strong></p>
  </li>
</ul>

<h3 id="files-that-do-not-need-modification">Files that do not need modification</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hev_finaldrive.m</code>: Defines the transmission torque and speed
based on vehicle torque and speed.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">hev_transmission.m</code>: Defines motor speed and torques based on
transmission and engine speed and torques. <strong>This file is for power-split
powertrain only.</strong></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">paretoset.m</code>: Auxiliary file for finding the pareto optimal
data points from a data set.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PoP_battery.m</code>: Defines battery power consumption based on battery
voltage and current.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PoP_engine.m</code>: Defines engine fuel consumption and max torque.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PoP_motor42.m</code>: Defines motor power consumption and max torque.</p>
  </li>
</ul>

<h3 id="instruction-on-modifications">Instruction on modifications</h3>

<p>On line 63-64, 126-128 of <code class="language-plaintext highlighter-rouge">fMPG.m</code>, and line 70-72 of <code class="language-plaintext highlighter-rouge">hybrid_ECMS_ATC.m</code>,
you need to complete the code for computing the motor torque and speed from
engine and transmission torque and speed.</p>

<p>For a parallel hybrid powertrain, the engine, motor, and the transmission share
the same angular speed. The torque from the transmission is split between the engine
and the motor.</p>

<p>For power-split powertrain, the relationship is more involving. You can find
a discussion from this <a href="http://designinformaticslab.github.io/_papers/jmd2016topology.pdf">paper</a>.</p>

:ET